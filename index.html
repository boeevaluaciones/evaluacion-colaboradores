<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluación de Colaboradores</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3ff6;
        }
        .form-section {
            @apply bg-white p-6 rounded-2xl shadow-lg mb-6;
        }
        .form-group {
            @apply mb-4;
        }
        label {
            @apply block text-sm font-medium text-gray-700 mb-1;
        }
        input[type="text"], input[type="number"], select, textarea {
            @apply w-full p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition-all duration-200;
        }
        .checkbox-group {
            @apply flex flex-col space-y-2;
        }
        .checkbox-container {
            @apply flex items-center;
        }
        .checkbox-container input[type="checkbox"] {
            @apply h-4 w-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500;
        }
        .loading-overlay {
            @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50;
        }
        .spinner {
            @apply animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-white;
        }
        .modal {
            @apply fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden;
        }
        .modal-content {
            @apply bg-white p-8 rounded-xl shadow-2xl w-11/12 max-w-lg text-left;
        }
        .btn-primary {
            @apply w-full py-2 px-4 rounded-lg bg-blue-600 text-white font-semibold hover:bg-blue-700 transition-colors duration-200;
        }
        .list-item {
            @apply bg-gray-50 p-4 rounded-lg shadow-sm mb-2 transition-all duration-200 ease-in-out hover:shadow-md cursor-pointer;
        }
        .details-grid {
            @apply grid grid-cols-1 sm:grid-cols-2 gap-4 mt-4 text-sm;
        }
        .collaborator-list-item {
            @apply bg-gray-50 p-4 rounded-lg shadow-sm mb-2 flex justify-between items-center transition-all duration-200 ease-in-out hover:shadow-md;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-8">
<script type="module">
    // NOTA: Este script no es estrictamente necesario, ya que el segundo script inicializa Firebase.
    // Lo mantengo por si tienes otra lógica en él. Si se elimina, el segundo script funcionará igual.
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.3.0/firebase-analytics.js";

    const firebaseConfig = {
        apiKey: "AIzaSyD-gcLSOMmwFXGAOPkUX5K9ASScYYPr2Lk",
        authDomain: "evaluaciones-mercadeo.firebaseapp.com",
        projectId: "evaluaciones-mercadeo",
        storageBucket: "evaluaciones-mercadeo.firebasestorage.app",
        messagingSenderId: "193530628861",
        appId: "1:193530628861:web:b79824793a72973c7c8c94",
        measurementId: "G-T7MN6W8XZ5"
    };

    const app = initializeApp(firebaseConfig);
    // const analytics = getAnalytics(app); // Se comenta si no se usa para evitar warnings
</script>
    <div id="message-modal" class="modal">
        <div class="modal-content text-center">
            <div id="modal-icon" class="text-4xl mb-4"></div>
            <p id="modal-text" class="text-lg font-medium mb-4"></p>
            <button id="close-modal-btn" class="btn-primary">Cerrar</button>
        </div>
    </div>

    <div id="details-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-end items-center mb-4">
                <button id="close-details-modal-btn" class="text-gray-500 hover:text-gray-700"><i class="fas fa-times text-2xl"></i></button>
            </div>
            <div id="details-content" class="max-h-96 overflow-y-auto">
                </div>
        </div>
    </div>

    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="spinner"></div>
    </div>

    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-gray-800">Medición de Desempeño</h1>
            <p class="text-gray-500 mt-2">Completa el formulario para registrar una nueva evaluación.</p>
            <p id="user-info" class="text-sm text-gray-400 mt-2">ID de usuario: <span id="user-id">Cargando...</span></p>
        </header>

        <main class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="form-section">
                <form id="evaluation-form" class="space-y-6">
                    <h2 class="text-xl font-semibold text-gray-700 mb-4">Datos del Colaborador</h2>
                    <div class="form-group">
                        <label for="collaborator">Nombre Colaborador(a)</label>
                        <select id="collaborator" required>
                            <option value="">Selecciona un colaborador</option>
                        </select>
                    </div>

                    <div id="collaborator-info" class="text-sm text-gray-500 hidden mb-6">
                        <p><strong>Código:</strong> <span id="collab-code"></span></p>
                        <p><strong>Posición:</strong> <span id="collab-position"></span></p>
                    </div>

                    <h2 class="text-xl font-semibold text-gray-700 mt-8 mb-4">Puntos de Evaluación</h2>
                    
                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">1. Espacios</h3>
                        <div class="form-group grid grid-cols-2 gap-4">
                            <div>
                                <label for="esp-anterior">Anterior</label>
                                <input type="number" id="esp-anterior" class="esp-input" value="0">
                            </div>
                            <div>
                                <label for="esp-actual">Actual</label>
                                <input type="number" id="esp-actual" class="esp-input" value="0">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="esp-diferencia">Diferencia</label>
                            <input type="number" id="esp-diferencia" readonly class="bg-gray-200" value="0">
                        </div>
                        <div class="form-group">
                            <label for="esp-puntuacion">Puntuación</label>
                            <input type="number" step="0.01" id="esp-puntuacion" value="0">
                        </div>
                        <div class="form-group">
                            <label for="esp-observacion">Observación</label>
                            <textarea id="esp-observacion" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">2. Presencia</h3>
                        <div class="form-group checkbox-group">
                            <div class="checkbox-container">
                                <input type="checkbox" id="pres-surtido" class="pres-checkbox">
                                <label for="pres-surtido" class="ml-2">Surtido</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="pres-agotado" class="pres-checkbox">
                                <label for="pres-agotado" class="ml-2">Agotado</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="pres-faltante" class="pres-checkbox">
                                <label for="pres-faltante" class="ml-2">Faltante</label>
                            </div>
                        </div>
                        <div class="form-group mt-4">
                            <label for="pres-puntuacion">Puntuación</label>
                            <input type="number" id="pres-puntuacion" readonly class="bg-gray-200" value="0">
                        </div>
                        <div class="form-group">
                            <label for="pres-observacion">Observación</label>
                            <textarea id="pres-observacion" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">3. Precios</h3>
                        <div class="form-group checkbox-group">
                            <div class="checkbox-container">
                                <input type="checkbox" id="prec-correcto" class="prec-checkbox">
                                <label for="prec-correcto" class="ml-2">Correcto</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="prec-marcado" class="prec-checkbox">
                                <label for="prec-marcado" class="ml-2">Marcado</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="prec-pop" class="prec-checkbox">
                                <label for="prec-pop" class="ml-2">Pop</label>
                            </div>
                        </div>
                        <div class="form-group mt-4">
                            <label for="prec-puntuacion">Puntuación</label>
                            <input type="number" id="prec-puntuacion" readonly class="bg-gray-200" value="0">
                        </div>
                        <div class="form-group">
                            <label for="prec-observacion">Observación</label>
                            <textarea id="prec-observacion" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">4. Exhibición</h3>
                        <div class="form-group checkbox-group">
                            <div class="checkbox-container">
                                <input type="checkbox" id="exh-pop" class="exh-checkbox">
                                <label for="exh-pop" class="ml-2">Pop</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="exh-planograma" class="exh-checkbox">
                                <label for="exh-planograma" class="ml-2">Planograma</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="exh-adicional" class="exh-checkbox">
                                <label for="exh-adicional" class="ml-2">Adicional</label>
                            </div>
                        </div>
                        <div class="form-group mt-4">
                            <label for="exh-puntuacion">Puntuación</label>
                            <input type="number" id="exh-puntuacion" readonly class="bg-gray-200" value="0">
                        </div>
                        <div class="form-group">
                            <label for="exh-observacion">Observación</label>
                            <textarea id="exh-observacion" rows="2"></textarea>
                        </div>
                    </div>
                    
                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">5. Conocimiento</h3>
                        <div class="form-group checkbox-group">
                            <div class="checkbox-container">
                                <input type="checkbox" id="con-speech" class="con-checkbox">
                                <label for="con-speech" class="ml-2">Speech</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="con-productos" class="con-checkbox">
                                <label for="con-productos" class="ml-2">Productos</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="con-modo" class="con-checkbox">
                                <label for="con-modo" class="ml-2">Modo</label>
                            </div>
                        </div>
                        <div class="form-group mt-4">
                            <label for="con-puntuacion">Puntuación</label>
                            <input type="number" id="con-puntuacion" readonly class="bg-gray-200" value="0">
                        </div>
                        <div class="form-group">
                            <label for="con-observacion">Observación</label>
                            <textarea id="con-observacion" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">6. Imagen</h3>
                        <div class="form-group checkbox-group">
                            <div class="checkbox-container">
                                <input type="checkbox" id="ima-uniforme" class="ima-checkbox">
                                <label for="ima-uniforme" class="ml-2">Uniforme</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="ima-carnet" class="ima-checkbox">
                                <label for="ima-carnet" class="ml-2">Carnet</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="ima-imagen" class="ima-checkbox">
                                <label for="ima-imagen" class="ml-2">Imagen</label>
                            </div>
                        </div>
                        <div class="form-group mt-4">
                            <label for="ima-puntuacion">Puntuación</label>
                            <input type="number" id="ima-puntuacion" readonly class="bg-gray-200" value="0">
                        </div>
                        <div class="form-group">
                            <label for="ima-observacion">Observación</label>
                            <textarea id="ima-observacion" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">7. Ventas del Mes</h3>
                        <div class="form-group grid grid-cols-2 gap-4">
                            <div>
                                <label for="venta-rd">Venta RD</label>
                                <input type="number" id="venta-rd" value="0">
                            </div>
                            <div>
                                <label for="venta-unidades">Venta Unidades</label>
                                <input type="number" id="venta-unidades" value="0">
                            </div>
                        </div>
                    </div>

                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">8. Reporte de Visita</h3>
                        <div class="form-group grid grid-cols-2 gap-4">
                            <div>
                                <label for="tipo-visita">Tipo Visita</label>
                                <select id="tipo-visita">
                                    <option>OBJETIVO</option>
                                    <option>SEGUIMIENTO</option>
                                </select>
                            </div>
                            <div>
                                <label for="asistencia">Asistencia</label>
                                <select id="asistencia">
                                    <option>EN PUESTO</option>
                                    <option>FUERA DE PUESTO</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group mt-4">
                            <label for="otras-observaciones">Otras Observaciones</label>
                            <textarea id="otras-observaciones" rows="3"></textarea>
                        </div>
                    </div>

                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">9. Política y Valores</h3>
                        <div class="form-group checkbox-group grid grid-cols-2 gap-2">
                            <div class="checkbox-container">
                                <input type="checkbox" id="politica">
                                <label for="politica" class="ml-2">Política</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="mision">
                                <label for="mision" class="ml-2">Misión</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="vision">
                                <label for="vision" class="ml-2">Visión</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="valores">
                                <label for="valores" class="ml-2">Valores</label>
                            </div>
                        </div>
                        <div class="form-group mt-4">
                            <label for="otras-observaciones-2">Otras Observaciones</label>
                            <textarea id="otras-observaciones-2" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">10. Puntos de Desarrollo</h3>
                        <div class="form-group checkbox-group grid grid-cols-2 gap-2">
                            <div class="checkbox-container">
                                <input type="checkbox" id="llenado">
                                <label for="llenado" class="ml-2">Llenado Planificador</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="cambio">
                                <label for="cambio" class="ml-2">Cambio Ruta/Horario</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="oportunidad">
                                <label for="oportunidad" class="ml-2">Oportunidad Mejora</label>
                            </div>
                            <div class="checkbox-container">
                                <input type="checkbox" id="entrenamiento">
                                <label for="entrenamiento" class="ml-2">Entrenamiento Producto</label>
                            </div>
                        </div>
                    </div>

                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">11. Especifique</h3>
                        <div class="form-group">
                            <textarea id="especifique" rows="2"></textarea>
                        </div>
                    </div>

                    <div class="form-section p-4 bg-gray-50 shadow-none">
                        <h3 class="font-semibold text-gray-600 mb-2">12. Puntos Trabajados</h3>
                        <div class="form-group">
                            <textarea